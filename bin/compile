#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# fail fast
set -e

# Variables for GCC version and dependencies
GCC_VERSION="13.2.0"
GMP_VERSION="6.2.1"
MPFR_VERSION="4.2.0"
MPC_VERSION="1.3.1"

# clone gcc-13
echo "-----> Downloading gcc $GCC_VERSION files"
BUILD_DIR=$1
cd $BUILD_DIR/vendor
wget https://ftp.gnu.org/gnu/gcc/gcc-$GCC_VERSION/gcc-$GCC_VERSION.tar.gz
tar -zxvf gcc-$GCC_VERSION.tar.gz
rm -f gcc-$GCC_VERSION.tar.gz

echo "-----> Downloading gmp $GMP_VERSION files"
wget https://ftp.gnu.org/gnu/gmp/gmp-$GMP_VERSION.tar.xz
tar -xf gmp-$GMP_VERSION.tar.xz
mv gmp-$GMP_VERSION gcc-$GCC_VERSION/gmp

echo "-----> Downloading mpfr $MPFR_VERSION files"
wget https://www.mpfr.org/mpfr-$MPFR_VERSION/mpfr-$MPFR_VERSION.tar.xz
tar -xf mpfr-$MPFR_VERSION.tar.xz
mv mpfr-$MPFR_VERSION gcc-$GCC_VERSION/mpfr

echo "-----> Downloading mpc $MPC_VERSION files"
wget https://ftp.gnu.org/gnu/mpc/mpc-$MPC_VERSION.tar.gz
tar -zxvf mpc-$MPC_VERSION.tar.gz
mv mpc-$MPC_VERSION gcc-$GCC_VERSION/mpc

echo "-----> Making..."
mkdir gcc-$GCC_VERSION-build
cd gcc-$GCC_VERSION-build
../gcc-$GCC_VERSION/configure --prefix=/opt/gcc-$GCC_VERSION/ --disable-multilib --enable-languages=c,c++

make -j$(nproc)
make install

echo "-----> Cleaning up..."
cd ..
rm -rf gcc-$GCC_VERSION
rm -rf gcc-$GCC_VERSION-build